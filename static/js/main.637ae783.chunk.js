(this["webpackJsonpminiapp-mic-test"]=this["webpackJsonpminiapp-mic-test"]||[]).push([[0],{140:function(e,t,n){"use strict";n.r(t);var o=n(0),s=n.n(o),r=n(14),a=n.n(r),i=n(15),c=n.n(i),l=n(21),u=n(11),d=(n(138),n(9)),h=n.n(d),j=n(3),m=function(){var e=function(){var e=s.a.useRef();return s.a.useEffect((function(){var t=e.current;console.log("root",t);var n,o,s,r=t.getElementsByTagName("path"),a=t.querySelector("#visualizer"),i=a.querySelector("#mask"),c=t.getElementsByTagName("h1")[0],l=t.getElementsByTagName("h1")[1],u=!1,d=!1,j=0,m=function(e){console.log("soundAllowed 0"),d=!0;var t=o.createMediaStreamSource(e),n=o.createAnalyser();n.fftSize=1024,t.connect(n);var h=n.frequencyBinCount,m=new Uint8Array(h);a.setAttribute("viewBox","0 0 255 255");for(var f=0;f<255;f++)(s=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("stroke-dasharray","4,1"),i.appendChild(s);!function e(){if(requestAnimationFrame(e),u){var t;n.getByteFrequencyData(m);for(var o=0;o<255;o++)t=Math.floor(m[o])-Math.floor(m[o])%5,r[o].setAttribute("d","M "+o+",255 l 0,-"+t)}else for(o=0;o<255;o++)r[o].setAttribute("d","M "+o+",255 l 0,-0")}(),function e(){if(console.log("soundAllowed 1"),setTimeout(e,500),u){n.getByteFrequencyData(m),console.log("soundAllowed 2");for(var t=0,o=0;o<255;o++){var s=m[o];t+=s*s}var r=Math.sqrt(t/h),a=Math.log(r)/Math.log(10)*20;a=Math.max(a,0),c.innerHTML=Math.floor(a)+" dB",a>=30?(j+=.5)>=5&&(l.innerHTML="You\u2019ve been in loud environment for<span> "+Math.floor(j)+" </span>seconds."):(j=0,l.innerHTML="")}else c.innerHTML="",l.innerHTML=""}()},f=function(e){c.innerHTML="You must allow your microphone.",console.log(e)};t.querySelector("#button").onclick=function(){u?(u=!1,this.innerHTML="Start Listen",this.className=h.a.greenButton):(d||(navigator.mediaDevices.getUserMedia({audio:!0}).then(m).catch(f),n=window.AudioContext||window.webkitAudioContext,o=new n),u=!0,this.innerHTML="Stop Listen",this.className=h.a.redButton)}}),[]),{rootRef:e}}(),t=e.rootRef;return Object(j.jsxs)("div",{className:h.a.page,ref:t,children:[Object(j.jsxs)("svg",{preserveAspectRatio:"none",id:"visualizer",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[Object(j.jsxs)("defs",{children:[Object(j.jsx)("mask",{id:"mask",children:Object(j.jsx)("g",{id:"maskGroup"})}),Object(j.jsxs)("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[Object(j.jsx)("stop",{offset:"0%",style:{stopColor:"#db6247",stopOpacity:1}}),Object(j.jsx)("stop",{offset:"40%",style:{stopColor:"#f6e5d1",stopOpacity:1}}),Object(j.jsx)("stop",{offset:"60%",style:{stopColor:"#5c79c7",stopOpacity:1}}),Object(j.jsx)("stop",{offset:"85%",style:{stopColor:"#b758c0",stopOpacity:1}}),Object(j.jsx)("stop",{offset:"100%",style:{stopColor:"#222",stopOpacity:1}})]})]}),Object(j.jsx)("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient)",mask:"url(#mask)"})]}),Object(j.jsx)("h1",{className:h.a.mainText,children:"Please allow the use of your microphone."}),Object(j.jsx)("h1",{className:h.a.subText}),Object(j.jsx)("div",{className:h.a.buttonContainer,children:Object(j.jsx)("button",{id:"button",className:h.a.greenButton,children:"Start Listen"})})]})},f=function(e){var t=e.id;return Object(j.jsxs)(u.c,{id:t,children:[Object(j.jsx)(u.d,{children:"Mic test"}),Object(j.jsx)(m,{})]})},b=function(){var e=Object(o.useState)("home"),t=Object(l.a)(e,2),n=t[0],s=t[1];return Object(j.jsx)(u.a,{children:Object(j.jsx)(u.b,{children:Object(j.jsx)(u.e,{activePanel:n,children:Object(j.jsx)(f,{id:"home",go:function(e){s(e.currentTarget.dataset.to)}})})})})};c.a.send("VKWebAppInit"),a.a.render(Object(j.jsx)(b,{}),document.getElementById("root")),new URL(location.href).searchParams.has("debug")&&Promise.all([n.e(3),n.e(4)]).then(n.bind(null,145)).then((function(e){e.default}))},9:function(e,t,n){e.exports={page:"Home_page__1jasW",mainText:"Home_mainText__gTljH",subText:"Home_subText__3jxBA",buttonContainer:"Home_buttonContainer__3Yy22",greenButton:"Home_greenButton__3IIsz",redButton:"Home_redButton__2uyVS"}}},[[140,1,2]]]);
//# sourceMappingURL=main.637ae783.chunk.js.map