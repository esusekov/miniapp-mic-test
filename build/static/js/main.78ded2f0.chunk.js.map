{"version":3,"sources":["panels/Home.js","App.js","index.js","panels/Home.module.scss"],"names":["Mic","rootRef","React","useRef","useEffect","root","current","console","log","AudioContext","audioContent","path","paths","getElementsByTagName","visualizer","querySelector","mask","h","hSub","start","permission","seconds","soundAllowed","stream","audioStream","createMediaStreamSource","analyser","createAnalyser","fftSize","connect","bufferLength","frequencyBinCount","frequencyArray","Uint8Array","setAttribute","i","document","createElementNS","appendChild","doDraw","requestAnimationFrame","adjustedLength","getByteFrequencyData","Math","floor","showVolume","setTimeout","total","x","rms","sqrt","db","max","innerHTML","soundNotAllowed","error","onclick","this","className","styles","greenButton","navigator","mediaDevices","getUserMedia","audio","then","catch","window","webkitAudioContext","redButton","useMicLogic","page","ref","preserveAspectRatio","id","version","xmlns","x1","y1","x2","y2","offset","style","stopColor","stopOpacity","y","width","height","fill","mainText","subText","buttonContainer","Home","App","useState","activePanel","setActivePanel","go","e","currentTarget","dataset","to","bridge","send","ReactDOM","render","getElementById","module","exports"],"mappings":"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","file":"static/js/main.78ded2f0.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { Panel, PanelHeader, Header, Button, Group, Cell, Div, Avatar } from '@vkontakte/vkui';\nimport styles from './Home.module.scss';\n\nconst useMicLogic = () => {\n\tconst rootRef = React.useRef();\n\n\tReact.useEffect(() => {\n\t\tconst root = rootRef.current;\n\t\tconsole.log('root', root);\n\t\tvar paths = root.getElementsByTagName('path');\n\t\tvar visualizer = root.querySelector('#visualizer');\n\t\tvar mask = visualizer.querySelector('#mask');\n\t\tvar h = root.getElementsByTagName('h1')[0];\n\t\tvar hSub = root.getElementsByTagName('h1')[1];\n\t\tvar AudioContext;\n\t\tvar audioContent;\n\t\tvar start = false;\n\t\tvar permission = false;\n\t\tvar path;\n\t\tvar seconds = 0;\n\t\tvar loud_volume_threshold = 30;\n\n\t\tvar soundAllowed = function (stream) {\n\t\t\tconsole.log('soundAllowed 0');\n\t\t\tpermission = true;\n\t\t\tvar audioStream = audioContent.createMediaStreamSource( stream );\n\t\t\tvar analyser = audioContent.createAnalyser();\n\t\t\tvar fftSize = 1024;\n\n\t\t\tanalyser.fftSize = fftSize;\n\t\t\taudioStream.connect(analyser);\n\n\t\t\tvar bufferLength = analyser.frequencyBinCount;\n\t\t\tvar frequencyArray = new Uint8Array(bufferLength);\n\n\t\t\tvisualizer.setAttribute('viewBox', '0 0 255 255');\n\n\t\t\tfor (var i = 0 ; i < 255; i++) {\n\t\t\t\tpath = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\t\t\t\tpath.setAttribute('stroke-dasharray', '4,1');\n\t\t\t\tmask.appendChild(path);\n\t\t\t}\n\t\t\tvar doDraw = function () {\n\t\t\t\trequestAnimationFrame(doDraw);\n\t\t\t\tif (start) {\n\t\t\t\t\tanalyser.getByteFrequencyData(frequencyArray);\n\t\t\t\t\tvar adjustedLength;\n\t\t\t\t\tfor (var i = 0 ; i < 255; i++) {\n\t\t\t\t\t\tadjustedLength = Math.floor(frequencyArray[i]) - (Math.floor(frequencyArray[i]) % 5);\n\t\t\t\t\t\tpaths[i].setAttribute('d', 'M '+ (i) +',255 l 0,-' + adjustedLength);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfor (var i = 0 ; i < 255; i++) {\n\t\t\t\t\t\tpaths[i].setAttribute('d', 'M '+ (i) +',255 l 0,-' + 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar showVolume = function () {\n\t\t\t\tconsole.log('soundAllowed 1');\n\t\t\t\tsetTimeout(showVolume, 500);\n\t\t\t\tif (start) {\n\t\t\t\t\tanalyser.getByteFrequencyData(frequencyArray);\n\t\t\t\t\tconsole.log('soundAllowed 2');\n\t\t\t\t\tvar total = 0\n\t\t\t\t\tfor(var i = 0; i < 255; i++) {\n\t\t\t\t\t\tvar x = frequencyArray[i];\n\t\t\t\t\t\ttotal += x * x;\n\t\t\t\t\t}\n\t\t\t\t\tvar rms = Math.sqrt(total / bufferLength);\n\t\t\t\t\tvar db = 20 * ( Math.log(rms) / Math.log(10) );\n\t\t\t\t\tdb = Math.max(db, 0); // sanity check\n\t\t\t\t\th.innerHTML = Math.floor(db) + \" dB\";\n\n\t\t\t\t\tif (db >= loud_volume_threshold) {\n\t\t\t\t\t\tseconds += 0.5;\n\t\t\t\t\t\tif (seconds >= 5) {\n\t\t\t\t\t\t\thSub.innerHTML = \"Youâ€™ve been in loud environment for<span> \" + Math.floor(seconds) + \" </span>seconds.\" ;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tseconds = 0;\n\t\t\t\t\t\thSub.innerHTML = \"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\th.innerHTML = \"\";\n\t\t\t\t\thSub.innerHTML = \"\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdoDraw();\n\t\t\tshowVolume();\n\t\t}\n\n\t\tvar soundNotAllowed = function (error) {\n\t\t\th.innerHTML = \"You must allow your microphone.\";\n\t\t\tconsole.log(error);\n\t\t}\n\n\n\t\troot.querySelector('#button').onclick = function () {\n\t\t\tif (start) {\n\t\t\t\tstart = false;\n\t\t\t\tthis.innerHTML = \"Start Listen\";\n\t\t\t\tthis.className = styles.greenButton;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!permission) {\n\t\t\t\t\tnavigator.mediaDevices.getUserMedia({audio:true})\n\t\t\t\t\t\t.then(soundAllowed)\n\t\t\t\t\t\t.catch(soundNotAllowed);\n\n\t\t\t\t\tAudioContext = window.AudioContext || window.webkitAudioContext;\n\t\t\t\t\taudioContent = new AudioContext();\n\t\t\t\t}\n\t\t\t\tstart = true;\n\t\t\t\tthis.innerHTML = \"Stop Listen\";\n\t\t\t\tthis.className = styles.redButton;\n\t\t\t}\n\t\t};\n\t}, []);\n\n\treturn { rootRef };\n}\n\nconst Mic = () => {\n\tconst { rootRef } = useMicLogic();\n\n\treturn (\n\t\t<div className={styles.page} ref={rootRef}>\n\t\t\t<svg preserveAspectRatio=\"none\" id=\"visualizer\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<defs>\n\t\t\t\t\t<mask id=\"mask\">\n\t\t\t\t\t\t<g id=\"maskGroup\" />\n\t\t\t\t\t</mask>\n\t\t\t\t\t<linearGradient id=\"gradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n\t\t\t\t\t\t<stop offset=\"0%\" style={{ stopColor: '#db6247', stopOpacity: 1 }} />\n\t\t\t\t\t\t<stop offset=\"40%\" style={{ stopColor: '#f6e5d1', stopOpacity: 1 }} />\n\t\t\t\t\t\t<stop offset=\"60%\" style={{ stopColor: '#5c79c7', stopOpacity: 1 }} />\n\t\t\t\t\t\t<stop offset=\"85%\" style={{ stopColor: '#b758c0', stopOpacity: 1 }} />\n\t\t\t\t\t\t<stop offset=\"100%\" style={{ stopColor: '#222', stopOpacity: 1 }} />\n\t\t\t\t\t</linearGradient>\n\t\t\t\t</defs>\n\t\t\t\t<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#gradient)\" mask=\"url(#mask)\" />\n\t\t\t</svg>\n\n\t\t\t<h1 className={styles.mainText}>Please allow the use of your microphone.</h1>\n\n\t\t\t<h1 className={styles.subText} />\n\n\t\t\t<div className={styles.buttonContainer}>\n\t\t\t\t<button id=\"button\" className={styles.greenButton}>\n\t\t\t\t\tStart Listen\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nconst Home = ({ id }) => (\n\t<Panel id={id}>\n\t\t<PanelHeader>Mic test</PanelHeader>\n\t\t<Mic />\n\t</Panel>\n);\n\nHome.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n};\n\nexport default Home;\n","import React, { useState, useEffect } from 'react';\nimport { View, ScreenSpinner, AdaptivityProvider, AppRoot } from '@vkontakte/vkui';\nimport '@vkontakte/vkui/dist/vkui.css';\n\nimport Home from './panels/Home';\n\nconst App = () => {\n\tconst [activePanel, setActivePanel] = useState('home');\n\t// const [fetchedUser, setUser] = useState(null);\n\t// const [popout, setPopout] = useState(<ScreenSpinner size='large' />);\n\t//\n\t// useEffect(() => {\n\t// \tbridge.subscribe(({ detail: { type, data }}) => {\n\t// \t\tif (type === 'VKWebAppUpdateConfig') {\n\t// \t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t// \t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t// \t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t// \t\t}\n\t// \t});\n\t// \tasync function fetchData() {\n\t// \t\tconst user = await bridge.send('VKWebAppGetUserInfo');\n\t// \t\tsetUser(user);\n\t// \t\tsetPopout(null);\n\t// \t}\n\t// \tfetchData();\n\t// }, []);\n\n\tconst go = e => {\n\t\tsetActivePanel(e.currentTarget.dataset.to);\n\t};\n\n\treturn (\n\t\t<AdaptivityProvider>\n\t\t\t<AppRoot>\n\t\t\t\t<View activePanel={activePanel} >\n\t\t\t\t\t<Home id='home' go={go} />\n\t\t\t\t</View>\n\t\t\t</AppRoot>\n\t\t</AdaptivityProvider>\n\t);\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"page\":\"Home_page__1jasW\",\"mainText\":\"Home_mainText__gTljH\",\"subText\":\"Home_subText__3jxBA\",\"buttonContainer\":\"Home_buttonContainer__3Yy22\",\"greenButton\":\"Home_greenButton__3IIsz\",\"redButton\":\"Home_redButton__2uyVS\"};"],"sourceRoot":""}